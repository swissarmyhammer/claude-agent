# Remove Per-Command and Default Execution Timeouts from Terminal Manager

## Description
Remove per-command and default execution timeout functionality from terminal manager while preserving graceful shutdown timeout for SIGKILL escalation.

## Problem
Command execution timeouts create artificial limitations:
- Commands may legitimately take a long time (builds, tests, large file operations)
- Users cannot predict when operations will be terminated
- Creates poor developer experience when legitimate commands are killed
- No meaningful way to distinguish between "hung" and "slow" commands

## Components to Modify

### Files to change:
- `lib/src/terminal_manager.rs:66-86` - Remove per-command timeout config
- `lib/src/terminal_manager.rs:630-676` - Remove `execute_with_timeout` method
- `lib/src/terminal_manager.rs:1287-1406` - Remove timeout-related tests

### Specific Changes:
1. **TimeoutConfig struct**: Remove `default_execution_timeout` and `command_timeouts` fields
2. **Keep graceful_shutdown_timeout**: This is needed for SIGKILL escalation during shutdown
3. **Remove execute_with_timeout**: Replace with normal execution without artificial time limits
4. **Remove timeout tests**: Remove `test_timeout_triggers_kill` and related tests

## Preserve SIGKILL Timeout
**Keep the graceful shutdown timeout** - this is different and necessary:
- Used when explicitly shutting down terminals
- Prevents zombie processes during cleanup
- 5-second timeout before escalating SIGTERM to SIGKILL

## Documentation Requirements
Add comment in `TimeoutConfig`:
```rust
// IMPORTANT: Do not add execution timeouts for commands.
// Commands should be allowed to run until completion or explicit user termination.
// Only graceful shutdown timeout is appropriate for cleanup scenarios.
// Execution timeouts create poor developer experience for legitimate long-running operations.
```

## Priority
Medium - Improves developer experience and removes artificial limitations

## Files Affected  
- `lib/src/terminal_manager.rs`


## Proposed Solution

After analyzing the code, I will implement the following changes to remove execution timeouts while preserving graceful shutdown timeout:

### 1. Modify TimeoutConfig Structure (lines 66-86)
- Remove `default_execution_timeout: Option<Duration>` field
- Remove `command_timeouts: HashMap<String, Duration>` field  
- Keep `graceful_shutdown_timeout: GracefulShutdownTimeout` field
- Remove `get_timeout_for_command` method (no longer needed)
- Add documentation comment explaining why execution timeouts should not be added

### 2. Remove execute_with_timeout Method (lines 630-676)
- Delete the entire `execute_with_timeout` method
- Delete `TerminalTimeoutResult` enum
- This removes the anti-pattern of timing out legitimate long-running operations

### 3. Remove Timeout-Related Tests
- Delete `test_timeout_triggers_kill` test (lines ~1287-1340)
- Delete `test_concurrent_wait_and_timeout` test (lines ~1342-1406)
- These tests validate timeout behavior that we're removing

### 4. Update TerminalState Enum
- Remove `TimedOut` state variant (no longer possible)
- Valid states: Created, Running, Finished, Killed, Released

### 5. Implementation Steps
1. Read the file to confirm exact line numbers
2. Remove `default_execution_timeout` and `command_timeouts` fields from TimeoutConfig
3. Remove `get_timeout_for_command` method
4. Add warning documentation to TimeoutConfig
5. Remove `execute_with_timeout` method and `TerminalTimeoutResult` enum
6. Remove `TimedOut` from TerminalState enum
7. Remove timeout-related tests
8. Run tests to ensure all remaining tests pass
9. Run clippy to check for any warnings

This preserves the graceful shutdown timeout (5 seconds for SIGTERM->SIGKILL escalation) which is appropriate for cleanup scenarios, while removing artificial execution timeouts that create poor developer experience.



## Implementation Complete

Successfully removed per-command and default execution timeouts from terminal manager while preserving graceful shutdown timeout.

### Changes Made

1. **TimeoutConfig struct (lib/src/terminal_manager.rs:66-78)**
   - Removed `default_execution_timeout: Option<Duration>` field
   - Removed `command_timeouts: HashMap<String, Duration>` field
   - Removed `get_timeout_for_command` method
   - Added comprehensive documentation warning against adding execution timeouts
   - Kept `graceful_shutdown_timeout: GracefulShutdownTimeout` for SIGKILL escalation

2. **TerminalState enum (lib/src/terminal_manager.rs:19-32)**
   - Removed `TimedOut` variant
   - Terminal states now: Created, Running, Finished, Killed, Released

3. **Removed execute_with_timeout method**
   - Deleted entire method and supporting logic (formerly lines 630-676)
   - Removed `TerminalTimeoutResult` enum
   - Commands no longer subject to artificial time limits

4. **Test cleanup**
   - Removed `test_timeout_triggers_kill` test
   - Removed `test_concurrent_wait_and_timeout` test  
   - Updated `test_terminal_state_transitions` to remove TimedOut state

### Verification

✅ `cargo build` - Compilation successful
✅ `cargo nextest run` - All 681 tests passed
✅ `cargo clippy` - No warnings

### Key Preservation

The graceful shutdown timeout remains intact for proper terminal cleanup:
- Used during `release_terminal` and `kill_process` operations
- Provides 5-second window for SIGTERM before escalating to SIGKILL
- Prevents zombie processes during cleanup
- This is appropriate for cleanup scenarios, not execution timeouts

### Developer Experience Impact

Commands can now run as long as needed without artificial termination:
- Long builds won't be killed
- Extensive test suites can complete
- Large file operations won't timeout
- Users have full control via explicit termination
